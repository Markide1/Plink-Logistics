<div class="h-full bg-blue-500 shadow-lg border-r border-blue-100 flex flex-col transition-all duration-300 ease-in-out"
    [class.w-64]="!isCollapsed" [class.w-16]="isCollapsed">

    <div class="flex items-center justify-end px-2 pt-4 pb-2">
        <button
            (click)="onToggleSidebar()"
            aria-label="Toggle sidebar"
            style="outline: none; background: none; border: none; padding: 0;"
        >
            <ng-container *ngIf="!isCollapsed">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="white" viewBox="0 0 24 24">
                    <path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                </svg>
            </ng-container>
            <ng-container *ngIf="isCollapsed">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="white" viewBox="0 0 24 24">
                    <path d="M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"/>
                </svg>
            </ng-container>
        </button>
    </div>

    <!-- Navigation Links -->
    <nav class="flex-1 overflow-y-auto py-4 px-2">
        <ul class="space-y-2">
            <li *ngFor="let item of sidebarItems">
                <a [routerLink]="item.route"
                   routerLinkActive="bg-blue-400 border-r-4 border-white"
                   [routerLinkActiveOptions]="{ exact: true }"
                   class="flex items-center px-3 py-3 text-white hover:bg-blue-400 hover:text-white rounded-lg transition-colors group relative"
                   [title]="isCollapsed ? item.label : ''">
                   <mat-icon class="flex-shrink-0 text-white">{{ item.icon }}</mat-icon>
                   <span *ngIf="!isCollapsed" class="ml-3 font-medium">{{ item.label }}</span>
                   <!-- Tooltip for collapsed state -->
                   <div *ngIf="isCollapsed"
                        class="absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50">
                        {{ item.label }}
                   </div>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Mobile overlay/backdrop -->
    <div 
      class="fixed inset-0 bg-black bg-opacity-40 z-40 md:hidden"
      *ngIf="!isCollapsed && isMobile()"
      (click)="onToggleSidebar()"
      aria-hidden="true">
    </div>

<!-- User Info Section at the bottom -->
<div class="px-4 pb-4 pt-2 flex flex-col items-center border-t border-blue-300" *ngIf="!isCollapsed">
  <div class="w-16 h-16 mb-2 flex items-center justify-center rounded-full bg-blue-700 overflow-hidden">
    <ng-container *ngIf="currentUser?.profileImage; else showInitials">
      <img [src]="currentUser.profileImage" alt="Profile" class="w-full h-full object-cover rounded-full" />
    </ng-container>
    <ng-template #showInitials>
      <span class="text-white text-2xl font-bold">{{ userInitials }}</span>
    </ng-template>
  </div>
  <div class="text-white text-base font-semibold">{{ userName }}</div>
  <div class="text-blue-100 text-sm">{{ currentUser?.email }}</div>
</div>

<!-- Collapsed state: show only avatar/initials as tooltip -->
<div class="px-2 pb-2 flex flex-col items-center border-t border-blue-300" *ngIf="isCollapsed">
  <div class="w-10 h-10 flex items-center justify-center rounded-full bg-blue-700 overflow-hidden group relative">
    <ng-container *ngIf="currentUser?.profileImage; else showInitialsCollapsed">
      <img [src]="currentUser.profileImage" alt="Profile" class="w-full h-full object-cover rounded-full" />
    </ng-container>
    <ng-template #showInitialsCollapsed>
      <span class="text-white text-lg font-bold">{{ userInitials }}</span>
    </ng-template>
    <!-- Tooltip for collapsed state -->
    <div class="absolute left-full ml-2 px-2 py-1 bg-gray-800 text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50">
      <div class="font-semibold">{{ userName }}</div>
      <div class="text-blue-100 text-xs">{{ currentUser?.email }}</div>
    </div>
  </div>
</div>
</div>